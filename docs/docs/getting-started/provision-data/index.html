<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=../../../css/style.css><link rel=stylesheet type=text/css href=../../../css/page-layouts/content-header.css><link rel=stylesheet type=text/css href=../../../css/sidebar/style.css><link rel=stylesheet type=text/css href=../../../css/page-layouts/style.css><link rel=stylesheet type=text/css href=../../../css/page-layouts/syntax.css><link rel=stylesheet type=text/css href=../../../css/tabs/style.css><link rel=stylesheet type=text/css href=../../../css/bootstrap.min.css><link rel=stylesheet href=../../../override/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source Code Pro"><link rel=stylesheet href=../../../feather-icons/css/iconfont.css><link rel=icon href=../../../images/favicon.png type=image/x-icon><style>:root{--white: #ffffff;--primary: #fff;--secondary: #1E1F21;--sidebar-bg: #f6f6f8;--sidebar-primary: #1E1F21;--accent: #e34a3a;--grey100: ;--grey200: #F9F9FA;--grey300: ;--grey400: ;--grey500: ;--grey600: #969DAC;--grey700: ;--grey800: ;--grey900: ;--grey-head: #EFEFF3;--nav-highlight: }</style><title>GA4GH Discovery Search API | Provision Data</title></head><body><div class=sidebar id=sidebar-nav><button id=logo-collapse-btn onclick="(function(){document.getElementById('sidebar-nav').classList.toggle('show');document.getElementById('content').classList.toggle('showing-nav')})()">
<img id=logo src=../../../images/logo.png alt="GA4GH Discovery Search API"></button><div class="card sidebar-card"><div class=collapse-header><a class=nav-link href=../../../docs/getting-started/><i class="icon-layers navicon"></i><h3 class="sidebar-h1 mainitem">Quick Start</h3></a></div><div class="collapse show"><div class=nav-list><a class=nav-link href=../../../docs/getting-started/introduction/><h3 class="sidebar-h2 subitem">Introduction</h3></a><a class=nav-link href=../../../docs/getting-started/provision-data/><h3 class="sidebar-h2 nav-highlight subitem" id=scrollto>Provision Data</h3></a><a class=nav-link href=../../../docs/getting-started/consume-data/><h3 class="sidebar-h2 subitem">Consume Data</h3></a><a class=nav-link href=../../../docs/getting-started/upload-result/><h3 class="sidebar-h2 subitem">Upload results</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../../docs/use-exisitng-data/><i class="icon-database navicon"></i><h3 class="sidebar-h1 mainitem">Use Existing Data</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../../docs/use-exisitng-data/retrofit-a-data-explorer/doc/><h3 class="sidebar-h2 subitem">Retrofit data explorers</h3></a><a class=nav-link href=../../../docs/use-exisitng-data/tables-in-a-bucket/doc/><h3 class="sidebar-h2 subitem">Tables-in-a-bucket</h3></a><a class=nav-link href=../../../docs/use-exisitng-data/using-preso/doc/><h3 class="sidebar-h2 subitem">Using Presto</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../../docs/security/><i class="icon-shield navicon"></i><h3 class="sidebar-h1 mainitem">Security</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../../docs/security/data-source/><h3 class="sidebar-h2 subitem">At the data source</h3></a><a class=nav-link href=../../../docs/security/search-endpoint/><h3 class="sidebar-h2 subitem">At the search endpoint</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../../docs/reference/><i class="icon-book navicon"></i><h3 class="sidebar-h1 mainitem">Implementation</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../../docs/reference/pagination-long-queries/><h3 class="sidebar-h2 subitem">Pagination and Long Running Queries</h3></a><a class=nav-link href=../../../docs/reference/sql-functions/><h3 class="sidebar-h2 subitem">SQL Functions</h3></a><a class=nav-link href=../../../docs/reference/sql-grammar/><h3 class="sidebar-h2 subitem">SQL Grammar</h3></a></div></div></div></div><div class=content id=content><div class=content-header><div id=search-input-div><button class=search-button id=search-button data-toggle=modal data-target=#search-input-modal onclick=setFocusToTextBox()><h3 class=search-button-text><i class="icon-search search-icon"></i>Find anything</h3></button><div class="modal search" id=search-input-modal><div id=search-input-modal class=modal-dialog><div id=search-input-div class=modal-content><input id=search-input type=text placeholder name=search autocomplete=off>
<span class=focus-border></span><section id=search-results class=search></section></div></div></div></div><div class=content-header-nav><a class=content-header-nav-link href=../../../api><i class=icon-code></i><span>Open API 3 Reference</span></a>
<a class=content-header-nav-link href=https://github.com/ga4gh-discovery/ga4gh-search><i class=icon-github></i><span>Doc Source</span></a>
<a class=content-header-nav-link href=https://github.com/ga4gh-discovery/><i class=icon-github></i><span>Discovery Workstream</span></a></div></div><div class=text-area><h2>Provision Data</h2><div class=row><div class=content-area><p class=boxtext></p><h4 id=implementation>Implementation</h4><p>The GA4GH API requires <a href=../../../api/#tag/tables>table operations</a> to be implemented to specification for basic discovery and browsing.</p><p>Optional but not required, <a href=../../../api/#tag/search>query operations</a> may be implemented to support querying with SQL.</p><p>The Search API is backend agnostic, which means any solution that implements the <a href=../../../api>API specification</a> is valid. You can use your favorite REST application frameworks to implement GA4GH Search Endpoints or a hosted blob store for a tables-in-a-bucket implementation requiring no code.</p><p>Checkout the following examples for some inspiration.</p></div><div class=example-area><div class=example><div class="content-textbox scroll"><h5 id=quick-links>Quick Links</h5><hr><p><a href=../../../api>Full API Specifications</a></p><p><a href=https://github.com/ga4gh-discovery/ga4gh-search>Placeholder for custodian examples</a></p></div></div></div></div><div class=row><div class=content-area><p class=boxtext></p><h4 id=tables-in-a-bucket-example>Tables-in-a-bucket example</h4><p>The specification allows for a no-code implementation as a collection of files served statically. This is the easiest way to start experimenting with the GA4GH Search API. As long as your storage bucket conforms to the correct file structure and it has the correct sharing permissions, it is a valid Search implementation.</p><p>A concrete example implementation is <a href=https://storage.googleapis.com/ga4gh-tables-example/tables>available here</a> and <a href=../../../docs/getting-started/consume-data/#browsing>try browsing this implementation</a> with these commands.</p><p></p></div><div class=example-area><div class=example><div class="content-textbox scroll"><p>Here&rsquo;s how you&rsquo;ll need to organize your folders</p><ul><li><code>tables</code>: served in response to <code>GET /tables</code></li><li><code>table/{table_name}/info</code>: served in response to <code>GET /table/{table_name}/info</code>. e.g. a table with the name <code>mytable</code> should have a corresponding file <code>table/mytable/info</code></li><li><code>table/{table_name}/data</code>: served in response to <code>GET /table/{table_name}/data</code>. e.g. a table with the name <code>mytable</code> should have a corresponding file <code>table/mytable/data</code></li><li><code>table/{table_name}/data_{pageNumber}</code>, which will be linked in the next_page_url of the first table (e.g. <code>mytable</code>).</li><li><code>table/{table_name}/data_models/{schemaFile}</code>: Though not required, data models may be linked via <a href=https://json-schema.org/latest/json-schema-core.html#rfc.section.8.3>$ref</a>. Data models can also be stored as static JSON documents, and be referred to by relative or absolute URLs.</li></ul></div></div></p><p></div></div><div class=row><div class=content-area><p class=boxtext></p><h4 id=try-out-a-reference-implementation>Try out a reference implementation</h4><p>This example was shown as a demo during the 2020 GA4GH Plenary. This app will run a reference Search implementation on docker and use a Presto instance hosted by DNAstack as the data source.</p><p>You’ll need docker set up on your system to run the Spring app, and you’ll need to have one of the client libraries installed from the <a href=../../../docs/getting-started/>Introduction Section</a>.</p><p>Further information about this example can be found <a href=../../../docs/use-exisitng-data/using-preso/doc/>here</a>.</p></div><div class=example-area><div class=example><nav><div class="nav nav-tabs tabs-head" role=tablist><a class="nav-item nav-link content-tab active" id=nav-2 data-toggle=tab href=#tab21 role=tab aria-controls=nav-home aria-selected=true>30 second quick start</a></div></nav><div class="tab-content scroll" id=2><div class="tab-pane fade show active" id=tab21 role=tabpanel aria-labelledby=nav-tabName1><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>docker pull postgres:latest
docker run -d --rm --network<span class=o>=</span><span class=s2>&#34;host&#34;</span> --name dnastack-ga4gh-search-db -e <span class=nv>POSTGRES_USER</span><span class=o>=</span>ga4ghsearchadapterpresto -e <span class=nv>POSTGRES_PASSWORD</span><span class=o>=</span>ga4ghsearchadapterpresto postgres
docker pull dnastack/ga4gh-search-adapter-presto:latest
docker run --rm --name dnastack-ga4gh-search -p 8089:8089 -e <span class=nv>PRESTO_DATASOURCE_URL</span><span class=o>=</span>https://presto-public.prod.dnastack.com -e <span class=nv>SPRING_PROFILES_ACTIVE</span><span class=o>=</span>no-auth dnastack/ga4gh-search-adapter-presto:latest
</code></pre></div></div></div></div></p><div class=example><nav><div class="nav nav-tabs tabs-head" role=tablist><a class="nav-item nav-link content-tab active" id=nav-2 data-toggle=tab href=#tab21 role=tab aria-controls=nav-home aria-selected=true>Python</a>
<a class="nav-item nav-link content-tab" id=nav-2 data-toggle=tab href=#tab22 role=tab aria-controls=nav-home aria-selected=false>R</a>
<a class="nav-item nav-link content-tab" id=nav-2 data-toggle=tab href=#tab23 role=tab aria-controls=nav-home aria-selected=false>CLI</a></div></nav><div class="tab-content scroll" id=2><div class="tab-pane fade show active" id=tab21 role=tabpanel aria-labelledby=nav-tabName1><div class=highlight><pre class=chroma><code class=language-Python data-lang=Python><span class=c1># init search client</span>
<span class=kn>from</span> <span class=nn>search_python_client.search</span> <span class=kn>import</span> <span class=n>DrsClient</span><span class=p>,</span> <span class=n>SearchClient</span>
<span class=n>base_url</span> <span class=o>=</span> <span class=s1>&#39;http://localhost:8089/&#39;</span>
<span class=n>search_client</span> <span class=o>=</span> <span class=n>SearchClient</span><span class=p>(</span><span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># get tables</span>
<span class=n>tables_iterator</span> <span class=o>=</span> <span class=n>search_client</span><span class=o>.</span><span class=n>get_table_list</span><span class=p>()</span>
<span class=n>tables</span> <span class=o>=</span> <span class=p>[</span><span class=nb>next</span><span class=p>(</span><span class=n>tables_iterator</span><span class=p>,</span> <span class=bp>None</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
<span class=n>tables</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=n>tables</span><span class=p>))</span>
<span class=k>print</span><span class=p>(</span><span class=n>tables</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># get table info</span>
<span class=n>table_name</span> <span class=o>=</span> <span class=s2>&#34;sample_phenopackets.ga4gh_tables.gecco_phenopackets&#34;</span>
<span class=n>table_info</span> <span class=o>=</span> <span class=n>search_client</span><span class=o>.</span><span class=n>get_table_info</span><span class=p>(</span><span class=n>table_name</span><span class=p>)</span>
<span class=k>print</span><span class=p>(</span><span class=n>table_info</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=c1># get table data</span>
<span class=n>table_name</span> <span class=o>=</span> <span class=s2>&#34;sample_phenopackets.ga4gh_tables.gecco_phenopackets&#34;</span>
<span class=n>table_data_iterator</span> <span class=o>=</span> <span class=n>search_client</span><span class=o>.</span><span class=n>get_table_data</span><span class=p>(</span><span class=n>table_name</span><span class=p>)</span>
<span class=n>table_data</span> <span class=o>=</span> <span class=p>[</span><span class=nb>next</span><span class=p>(</span><span class=n>table_data_iterator</span><span class=p>,</span> <span class=bp>None</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)]</span>
<span class=n>table_data</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=bp>None</span><span class=p>,</span> <span class=n>table_data</span><span class=p>))</span>
<span class=k>print</span><span class=p>(</span><span class=n>table_data</span><span class=p>)</span>
</code></pre></div></div><div class="tab-pane fade" id=tab22 role=tabpanel aria-labelledby=nav-tabName2><div class=highlight><pre class=chroma><code class=language-R data-lang=R><span class=c1># Fetch table list</span>
<span class=nf>library</span><span class=p>(</span><span class=n>httr</span><span class=p>)</span>
<span class=n>tables</span> <span class=o>&lt;-</span> <span class=n>ga4gh.search</span><span class=o>::</span><span class=nf>ga4gh_list_tables</span><span class=p>(</span><span class=s>&#34;http://localhost:8089&#34;</span><span class=p>)</span>
<span class=nf>print</span><span class=p>(</span><span class=n>tables</span><span class=p>)</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-R data-lang=R><span class=c1># Try a query</span>
<span class=n>search_result</span> <span class=o>&lt;-</span> <span class=n>ga4gh.search</span><span class=o>::</span><span class=nf>ga4gh_search</span><span class=p>(</span><span class=s>&#34;http://localhost:8089&#34;</span><span class=p>,</span> <span class=s>&#34;SELECT sample_phenopackets.ga4gh_tables.gecco_phenopackets&#34;</span><span class=p>)</span>
<span class=nf>print</span><span class=p>(</span><span class=n>tables</span><span class=p>)</span>
</code></pre></div></div><div class="tab-pane fade" id=tab23 role=tabpanel aria-labelledby=nav-tabName3><p>List tables</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>search-cli list --api-url http://localhost:8089
</code></pre></div><p>Get table info</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>search-cli info dbgap_demo.scr_gecco_susceptibility.sample_multi --api-url http://localhost:8089
</code></pre></div><p>Get table data</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>search-cli data dbgap_demo.scr_gecco_susceptibility.sample_multi --api-url http://localhost:8089
</code></pre></div></div></div></div></div></div></div></div><script src=../../../js/jquery-3.5.1.min.js></script><script src=../../../js/bootstrap.min.js></script><script src=https://unpkg.com/lunr/lunr.js></script><script>document.getElementById("scrollto").scrollIntoView(true);</script><script type=text/javascript>var idx,searchInput,searchResults=null
var documents=[]
function renderSearchResults(results){if(results.length>0){if(results.length>9){results=results.slice(0,10)}
searchResults.innerHTML=''
results.forEach(result=>{var article=document.createElement('article')
var uri="/ga4gh-search-docs"+result.ref.replace("/index.json","")
article.innerHTML=`
            <a href="${uri}" class="search-result-item"><p class="search-result-title">${documents[result.ref].title}</p> <i class="icon-external-link"></i></a>
            `
searchResults.appendChild(article)})}else{searchResults.innerHTML='<p>No results found.</p>'}}
function registerSearchHandler(){searchInput.oninput=function(event){if(searchInput.value==''){searchResults.innerHTML=''}else{var query=event.target.value
var results=idx.search(query+'*')
renderSearchResults(results)}}
searchInput.focus()
searchInput.placeholder=''}
$('#search-input-modal').on('shown.bs.modal',function(){$('#search-input').trigger('focus')})
window.onload=function(){searchInput=document.getElementById('search-input')
searchResults=document.getElementById('search-results')
fetch('/ga4gh-search-docs/docs/index.json',{method:'get'}).then(res=>res.json()).then(res=>{idx=lunr(function(){this.ref('url')
this.field('title')
this.field('content')
res.forEach(function(doc){this.add(doc)
documents[doc.url]={'title':doc.title,'content':doc.content,}},this)})
registerSearchHandler()}).catch(err=>{searchResults.innerHTML=`<p>${err}</p>`})}</script></body></html>