<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=../../css/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/content-header.css><link rel=stylesheet type=text/css href=../../css/sidebar/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/syntax.css><link rel=stylesheet type=text/css href=../../css/tabs/style.css><link rel=stylesheet type=text/css href=../../css/bootstrap.min.css><link rel=stylesheet type=text/css href=../../override/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Poppins"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source%20Code%20Pro"><link rel=stylesheet href=../../feather-icons/css/iconfont.css><link rel=icon href=../../images/favicon.ico type=image/x-icon><style>:root{--white: #ffffff;--primary: #fff;--secondary: #1E1F21;--sidebar-bg: #f6f6f8;--sidebar-primary: #1E1F21;--accent: #e34a3a;--grey100: ;--grey200: #F9F9FA;--grey300: ;--grey400: ;--grey500: ;--grey600: #1E1F21;--grey700: ;--grey800: ;--grey900: ;--grey-head: #EFEFF3;--nav-highlight: ;--body-font: Roboto;--heading-font: Poppins;--code-font: Source Code Pro}</style><title>Data Connect | Security</title></head><body><!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet type=text/css href=../../css/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/content-header.css><link rel=stylesheet type=text/css href=../../css/sidebar/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/style.css><link rel=stylesheet type=text/css href=../../css/page-layouts/syntax.css><link rel=stylesheet type=text/css href=../../css/tabs/style.css><link rel=stylesheet type=text/css href=../../css/bootstrap.min.css><link rel=stylesheet type=text/css href=../../override/style.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Poppins"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source%20Code%20Pro"><link rel=stylesheet href=../../feather-icons/css/iconfont.css><link rel=icon href=../../images/favicon.ico type=image/x-icon><style>:root{--white: #ffffff;--primary: #fff;--secondary: #1E1F21;--sidebar-bg: #f6f6f8;--sidebar-primary: #1E1F21;--accent: #e34a3a;--grey100: ;--grey200: #F9F9FA;--grey300: ;--grey400: ;--grey500: ;--grey600: #1E1F21;--grey700: ;--grey800: ;--grey900: ;--grey-head: #EFEFF3;--nav-highlight: ;--body-font: Roboto;--heading-font: Poppins;--code-font: Source Code Pro}</style><title>Data Connect | At Data Sources</title></head><body><div class=sidebar id=sidebar-nav><button id=logo-collapse-btn onclick="(function(){document.getElementById('sidebar-nav').classList.toggle('show');document.getElementById('content').classList.toggle('showing-nav')})()">
<img id=logo src=../../images/logo.png alt="Data Connect"><div class=site-title><h3 class=sidebar-h1>Data Connect</h3></div></button><div class="card sidebar-card"><div class=collapse-header><a class=nav-link href=../../docs/getting-started/><i class="icon-layers navicon"></i><h3 class="sidebar-h1 mainitem">Quick Start</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../docs/getting-started/introduction/><h3 class="sidebar-h2 subitem">Introduction</h3></a><a class=nav-link href=../../docs/getting-started/clients/><h3 class="sidebar-h2 subitem">Install Clients</h3></a><a class=nav-link href=../../docs/getting-started/provision-data/><h3 class="sidebar-h2 subitem">Provision Data</h3></a><a class=nav-link href=../../docs/getting-started/consume-data/><h3 class="sidebar-h2 subitem">Consume Data</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../docs/use-existing-data/><i class="icon-database navicon"></i><h3 class="sidebar-h1 mainitem">Use Existing Data</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../docs/use-existing-data/using-trino/doc/><h3 class="sidebar-h2 subitem">Using Trino</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../docs/security/><i class="icon-shield navicon"></i><h3 class="sidebar-h1 mainitem">Security</h3></a></div><div class="collapse show"><div class=nav-list><a class=nav-link href=../../docs/security/data-source/><h3 class="sidebar-h2 nav-highlight subitem" id=scrollto>At Data Sources</h3></a><a class=nav-link href=../../docs/security/search-endpoint/><h3 class="sidebar-h2 subitem">At Endpoints</h3></a></div></div><div class=collapse-header><a class=nav-link href=../../docs/reference/><i class="icon-book navicon"></i><h3 class="sidebar-h1 mainitem">Implementation</h3></a></div><div class=collapse><div class=nav-list><a class=nav-link href=../../docs/reference/pagination-long-queries/><h3 class="sidebar-h2 subitem">Pagination and Long Running Queries</h3></a><a class=nav-link href=../../docs/reference/sql-functions/><h3 class="sidebar-h2 subitem">SQL Functions</h3></a><a class=nav-link href=../../docs/reference/sql-grammar/><h3 class="sidebar-h2 subitem">SQL Grammar</h3></a></div></div></div><div class=footer-container></div></div><button id=sidebar-btn onclick="(function(){document.getElementById('sidebar-nav').classList.toggle('show');document.getElementById('content').classList.toggle('showing-nav')})()">
<i class="icon-menu mobile"></i></button><div class=content id=content><div class=content-header><div id=search-input-div><button class=search-button id=search-button data-toggle=modal data-target=#search-input-modal><h3 class=search-button-text><i class="icon-search search-icon"></i>Find anything</h3></button><div class="modal search" id=search-input-modal><div id=search-input-modal class=modal-dialog><div id=search-input-div class=modal-content><input id=search-input type=text placeholder name=search autocomplete=off>
<span class=focus-border></span><section id=search-results class=search></section></div></div></div></div><div class=content-header-nav><a class=content-header-nav-link href=../../api><i class=icon-code></i><span class=top-nav-text>API</span></a>
<a class=content-header-nav-link href=https://github.com/ga4gh-discovery/data-connect/blob/develop/SPEC.md><i class=icon-file-text></i><span class=top-nav-text>Specification</span></a>
<a class=content-header-nav-link href=https://github.com/ga4gh-discovery/data-connect/><i class=icon-github></i><span class=top-nav-text>Github</span></a></div></div><div class=text-area><h2>At Data Sources</h2><h4 id=securing-data-sources>Securing Data Sources</h4><p>This page discusses different approaches to securing a Data Connect implementation depending on which implementation path you choose and how complex your access needs are.</p><p>Data Connect can be implemented in many ways. For example:</p><ul><li>as static files in a web server or cloud bucket (&ldquo;tables in a bucket&rdquo;)</li><li>in front of a single database server (for example, PostgreSQL, MySQL, or ElasticSearch)</li><li>in front of many database servers (for example, using Trino)</li></ul><p>In addition, your dataset might require a single tier of access, where someone either has access to the whole thing or nothing at all, or you might require multiple access tiers where different users can access different subsets of the data.</p><h4 id=tables-in-a-bucket>Tables in a Bucket</h4><p>If you implement Data Connect using static JSON files in a web server or cloud file storage system, you can set the web server or cloud bucket to require an authentication tokens with each request.</p><p>If you are hosting your tables in a web server such as nginx, Express.js, Tomcat, or Apache HTTPD, you have the option of providing a custom authentication module that understands JWT bearer tokens.</p><p>With data consumers accessing cloud buckets directly, the easiest approach is to use an authentication mechanism supported by the cloud vendor. This may be acceptable if the data consumers are inside your own organization, and they already have a way to obtain cloud credentials.</p><p>To customize the authentication mechanism on tables-in-a-bucket (for example, if you are experimenting with a GA4GH Passport integration) then you may have a few options, depending on the cloud platform:</p><ol><li>Put your cloud bucket behind an HTTP proxy that checks authentication in a custom way. If you do this, ensure links such as <code>nextPageUrl</code> are relative in all your JSON files.</li><li>Check if your cloud storage system can delegate request authorization to a serverless function that you supply (eg. AWS Lambda, Google Cloud Function, Azure Function). This may be possible directly, or you may need to route requests through an API Gateway.</li></ol><h5 id=multi-tiered-access>Multi Tiered Access</h5><p>With tables-in-a-bucket, consider creating separate Data Connect implementations, each in their own bucket, for each access tier. This allows you to keep access policies uniform with each bucket, and gives you the flexibility to provide different data granularity to users within each tier.</p><h4 id=in-front-of-a-single-database>In Front of a Single Database</h4><p>In this case, you will be running custom server code that translates incoming requests from Data Connect API requests into the format natively understood by your backend database.</p><h5 id=single-tiered-access>Single Tiered Access</h5><p>Create a single database user for your Data Connect API server. Grant this user read-only access to only the tables that you wish to expose via Data Connect. Your custom server will access the database as this user.</p><p>On each incoming Data Connect HTTP request, check for a valid OAuth2 bearer token. If the token is valid, make the corresponding request to the backend database. The Data Connect API user&rsquo;s scope of access will be limited to what the database user can see.</p><h5 id=multi-tiered-access-1>Multi Tiered Access</h5><p>Create a database user for each access tier your Data Connect API server will support. Grant each user read-only access to only the tables that you wish to expose at that access tier. Your custom server will select the correct database user based on the credentials in the incoming requests.</p><p>On each incoming Data Connect HTTP request, check for a valid JWT OAuth2 bearer token. If the token is valid, examine its claims and select the appropriate database user. The Data Connect API user&rsquo;s scope of access will be limited to what the database user for their access tier can see.</p><p>If some access tiers should only see data at a coarser grain (for example, cohort-level statistics rather than subject-level data), consider one of the following approaches:</p><ul><li>create views of the data that only reveal data at the coarser grain, and grant the &lsquo;tiered database users&rsquo; access to these views only</li><li>pre-aggregate the data into tables or materialized views, and grant the &lsquo;tiered database users&rsquo; access to these tables or materialized views only</li></ul><p>Since there will typically be many more users with access to the coarser-grained view of the data, pre-aggregating the data offers a performance advantage as well.</p><h4 id=in-front-of-many-databases>In Front of Many Databases</h4><p>If you are exposing many databases under a single Data Connect API instance, you are probably using a Trino based implementation.</p><p>Trino provides the <a href=https://github.com/trinodb/trino/blob/master/core/trino-spi/src/main/java/io/trino/spi/security/SystemAccessControl.java>SystemAccessControl interface</a> which you can implement yourself to secure your data source.</p><p>A Trino-based Data Connect implementation will have a Data Connect API adapter service in front of Trino which accepts Data Connect API calls and relays them to Trino in its own API, just like the single database case outlined above. The adapter service should extract the user&rsquo;s JWT bearer token from the inbound request and include it in the Trino request under the <code>X-Trino-Extra-Credential</code> header.</p><p>From there, your implementation of the SystemAccessControl interface will have access to the JWT and its claims, and will be able to control access:</p><ul><li>Allow/Deny:<ul><li>Access per catalog, schema, table, and column</li><li>Access to see the definition of a view</li></ul></li><li>Filter:<ul><li>Visibility of catalogs, schemas, tables, and columns</li><li>Row-by-row table data using a filter expression</li></ul></li></ul><div class=footer-root><div class=footer-prev></div><div class=footer-nav><a class=content-header-nav-link href=../../api><i class=icon-code></i></a><a class=content-header-nav-link href=https://github.com/ga4gh-discovery/data-connect/blob/develop/SPEC.md><i class=icon-file-text></i></a><a class=content-header-nav-link href=https://github.com/ga4gh-discovery/data-connect/><i class=icon-github></i></a></div><div class=footer-next><a class=content-header-nav-link href=../../docs/security/search-endpoint/><i class=icon-arrow-right></i></a></div></div></div></div><script src=../../js/jquery-3.5.1.min.js></script><script src=../../js/bootstrap.min.js></script><script src=https://unpkg.com/lunr/lunr.js></script><script>document.getElementById("scrollto").scrollIntoView(true);</script><script type=text/javascript>var idx,searchInput,searchResults=null
var documents=[]
function renderSearchResults(results){if(results.length>0){if(results.length>9){results=results.slice(0,10)}
searchResults.innerHTML=''
results.forEach(result=>{var article=document.createElement('article')
var uri="/data-connect"+result.ref.replace("/index.json","")
article.innerHTML=`
            <a href="${uri}" class="search-result-item"><p class="search-result-title">${documents[result.ref].title}</p> <i class="icon-external-link"></i></a>
            `
searchResults.appendChild(article)})}else{searchResults.innerHTML='<p>No results found.</p>'}}
function registerSearchHandler(){searchInput.oninput=function(event){if(searchInput.value==''){searchResults.innerHTML=''}else{var query=event.target.value
var results=idx.search(query+'*')
renderSearchResults(results)}}
searchInput.focus()
searchInput.placeholder=''}
$('#search-input-modal').on('shown.bs.modal',function(){$('#search-input').trigger('focus')})
window.onload=function(){searchInput=document.getElementById('search-input')
searchResults=document.getElementById('search-results')
fetch('/data-connect/index.json',{method:'get'}).then(res=>res.json()).then(res=>{idx=lunr(function(){this.ref('url')
this.field('title')
this.field('content')
res.forEach(function(doc){this.add(doc)
documents[doc.url]={'title':doc.title,'content':doc.content,}},this)})
registerSearchHandler()}).catch(err=>{searchResults.innerHTML=`<p>${err}</p>`})}</script></body></html><script src=../../js/jquery-3.5.1.min.js></script><script src=../../js/bootstrap.min.js></script><script src=https://unpkg.com/lunr/lunr.js></script><script>document.getElementById("scrollto").scrollIntoView(true);</script><script type=text/javascript>var idx,searchInput,searchResults=null
var documents=[]
function renderSearchResults(results){if(results.length>0){if(results.length>9){results=results.slice(0,10)}
searchResults.innerHTML=''
results.forEach(result=>{var article=document.createElement('article')
var uri="/data-connect"+result.ref.replace("/index.json","")
article.innerHTML=`
            <a href="${uri}" class="search-result-item"><p class="search-result-title">${documents[result.ref].title}</p> <i class="icon-external-link"></i></a>
            `
searchResults.appendChild(article)})}else{searchResults.innerHTML='<p>No results found.</p>'}}
function registerSearchHandler(){searchInput.oninput=function(event){if(searchInput.value==''){searchResults.innerHTML=''}else{var query=event.target.value
var results=idx.search(query+'*')
renderSearchResults(results)}}
searchInput.focus()
searchInput.placeholder=''}
$('#search-input-modal').on('shown.bs.modal',function(){$('#search-input').trigger('focus')})
window.onload=function(){searchInput=document.getElementById('search-input')
searchResults=document.getElementById('search-results')
fetch('/data-connect/index.json',{method:'get'}).then(res=>res.json()).then(res=>{idx=lunr(function(){this.ref('url')
this.field('title')
this.field('content')
res.forEach(function(doc){this.add(doc)
documents[doc.url]={'title':doc.title,'content':doc.content,}},this)})
registerSearchHandler()}).catch(err=>{searchResults.innerHTML=`<p>${err}</p>`})}</script></body></html>